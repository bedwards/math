/* ============================================================
   Mathematics from First Principles â€” Stylesheet
   ============================================================ */

/* --- Custom Properties --- */
:root {
  /* Typography */
  --font-body: 'Crimson Pro', Georgia, 'Times New Roman', serif;
  --font-heading: 'Inter', 'Helvetica Neue', Arial, sans-serif;
  --font-axiom: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
  --font-size-base: 1.125rem;
  --line-height: 1.8;

  /* Light theme */
  --bg-primary: #fafaf8;
  --bg-secondary: #f0efe9;
  --bg-meta: #f5f3eb;
  --bg-nav: rgba(250, 250, 248, 0.92);
  --text-primary: #1a1a1a;
  --text-secondary: #4a4a4a;
  --text-muted: #7a7a7a;
  --border: #d4d0c8;
  --shadow: rgba(0,0,0,0.06);

  /* Section colors */
  --color-sets: #2563eb;
  --color-naturals: #16a34a;
  --color-groups: #d97706;
  --color-order: #e11d48;
  --color-topology: #7c3aed;
  --color-fields: #0d9488;
  --color-vectors: #4f46e5;
  --color-metric: #ea580c;
  --color-probability: #0891b2;
  --color-category: #475569;
  --color-finale: #b45309;

  /* Spacing */
  --section-gap: 6rem;
  --content-max-width: 44rem;

  /* Animation */
  --transition-speed: 0.3s;
}

[data-theme="dark"] {
  --bg-primary: #111110;
  --bg-secondary: #1c1c1a;
  --bg-meta: #1a1918;
  --bg-nav: rgba(17, 17, 16, 0.92);
  --text-primary: #e8e8e0;
  --text-secondary: #b0b0a8;
  --text-muted: #707068;
  --border: #333330;
  --shadow: rgba(0,0,0,0.3);

  --color-sets: #60a5fa;
  --color-naturals: #4ade80;
  --color-groups: #fbbf24;
  --color-order: #fb7185;
  --color-topology: #a78bfa;
  --color-fields: #2dd4bf;
  --color-vectors: #818cf8;
  --color-metric: #fb923c;
  --color-probability: #22d3ee;
  --color-category: #94a3b8;
  --color-finale: #f59e0b;
}

/* --- Reset & Base --- */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
}

body {
  font-family: var(--font-body);
  font-size: var(--font-size-base);
  line-height: var(--line-height);
  color: var(--text-primary);
  background: var(--bg-primary);
  transition: background var(--transition-speed), color var(--transition-speed);
  -webkit-font-smoothing: antialiased;
}

/* --- Side Navigation --- */
.side-nav {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100vh;
  padding: 1.5rem 1rem;
  background: var(--bg-nav);
  backdrop-filter: blur(12px);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  z-index: 100;
  transition: transform var(--transition-speed), background var(--transition-speed);
}

.side-nav .nav-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border);
}

.side-nav .nav-title {
  font-family: var(--font-heading);
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-muted);
}

#theme-toggle {
  background: none;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 0.3rem 0.5rem;
  cursor: pointer;
  font-size: 1rem;
  color: var(--text-secondary);
  transition: border-color var(--transition-speed);
}

#theme-toggle:hover {
  border-color: var(--text-secondary);
}

.nav-list {
  list-style: none;
  position: relative;
}

/* Vertical connecting line */
.nav-list::before {
  content: '';
  position: absolute;
  left: 8px;
  top: 8px;
  bottom: 8px;
  width: 1px;
  background: var(--border);
}

.nav-list li {
  position: relative;
  padding-left: 24px;
  margin-bottom: 0.15rem;
}

/* Dot/diamond markers */
.nav-list li::before {
  content: '';
  position: absolute;
  left: 4px;
  top: 50%;
  transform: translateY(-50%);
  width: 9px;
  height: 9px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg-primary);
  transition: all var(--transition-speed);
}

.nav-list li.meta-nav::before {
  border-radius: 1px;
  transform: translateY(-50%) rotate(45deg);
  width: 7px;
  height: 7px;
}

.nav-list li.finale-nav::before {
  border-radius: 1px;
  width: 10px;
  height: 10px;
  transform: translateY(-50%) rotate(45deg);
  border-color: var(--color-finale);
}

.nav-list li.active::before {
  background: var(--section-color, var(--text-primary));
  border-color: var(--section-color, var(--text-primary));
  box-shadow: 0 0 6px var(--section-color, var(--text-primary));
}

.nav-list li.meta-nav.active::before {
  background: var(--text-muted);
  border-color: var(--text-muted);
  box-shadow: 0 0 4px var(--text-muted);
}

.nav-list a {
  display: block;
  font-family: var(--font-heading);
  font-size: 0.78rem;
  font-weight: 400;
  color: var(--text-muted);
  text-decoration: none;
  padding: 0.25rem 0;
  transition: color var(--transition-speed);
  line-height: 1.3;
}

.nav-list li.active a {
  color: var(--text-primary);
  font-weight: 600;
}

.nav-list a:hover {
  color: var(--text-primary);
}

/* Nav section color hints */
.nav-list li[data-nav-color="sets"] { --section-color: var(--color-sets); }
.nav-list li[data-nav-color="naturals"] { --section-color: var(--color-naturals); }
.nav-list li[data-nav-color="groups"] { --section-color: var(--color-groups); }
.nav-list li[data-nav-color="order"] { --section-color: var(--color-order); }
.nav-list li[data-nav-color="topology"] { --section-color: var(--color-topology); }
.nav-list li[data-nav-color="fields"] { --section-color: var(--color-fields); }
.nav-list li[data-nav-color="vectors"] { --section-color: var(--color-vectors); }
.nav-list li[data-nav-color="metric"] { --section-color: var(--color-metric); }
.nav-list li[data-nav-color="probability"] { --section-color: var(--color-probability); }
.nav-list li[data-nav-color="category"] { --section-color: var(--color-category); }
.nav-list li[data-nav-color="finale"] { --section-color: var(--color-finale); }

/* Mobile nav toggle */
.nav-hamburger {
  display: none;
  position: fixed;
  top: 1rem;
  left: 1rem;
  z-index: 200;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.5rem 0.7rem;
  cursor: pointer;
  font-size: 1.2rem;
  color: var(--text-primary);
  box-shadow: 0 2px 8px var(--shadow);
}

/* --- Main Content --- */
main {
  max-width: var(--content-max-width);
  margin: 0 auto;
  padding: 2rem 2rem 8rem;
  margin-left: calc(220px + 4rem);
}

/* --- Hero --- */
.hero {
  padding: 6rem 0 4rem;
  text-align: center;
}

.hero h1 {
  font-family: var(--font-heading);
  font-size: 2.5rem;
  font-weight: 700;
  line-height: 1.2;
  color: var(--text-primary);
  margin-bottom: 1rem;
}

.hero .subtitle {
  font-size: 1.15rem;
  color: var(--text-secondary);
  max-width: 32rem;
  margin: 0 auto;
  font-style: italic;
}

/* --- Math Sections --- */
.math-section {
  padding: 4rem 0;
  margin-bottom: var(--section-gap);
  border-top: 1px solid var(--border);
}

.section-header {
  display: flex;
  align-items: baseline;
  gap: 1rem;
  margin-bottom: 2rem;
}

.section-number {
  font-family: var(--font-heading);
  font-size: 3rem;
  font-weight: 700;
  color: var(--section-color);
  line-height: 1;
  opacity: 0.3;
}

.math-section h2 {
  font-family: var(--font-heading);
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--text-primary);
  border-bottom: 3px solid var(--section-color);
  padding-bottom: 0.3rem;
}

/* Section color assignments */
[data-color="sets"]        { --section-color: var(--color-sets); }
[data-color="naturals"]    { --section-color: var(--color-naturals); }
[data-color="groups"]      { --section-color: var(--color-groups); }
[data-color="order"]       { --section-color: var(--color-order); }
[data-color="topology"]    { --section-color: var(--color-topology); }
[data-color="fields"]      { --section-color: var(--color-fields); }
[data-color="vectors"]     { --section-color: var(--color-vectors); }
[data-color="metric"]      { --section-color: var(--color-metric); }
[data-color="probability"] { --section-color: var(--color-probability); }
[data-color="category"]    { --section-color: var(--color-category); }
[data-color="finale"]      { --section-color: var(--color-finale); }

/* One-liner */
.one-liner {
  font-size: 1.2rem;
  color: var(--text-secondary);
  margin-bottom: 2rem;
  font-weight: 400;
}

/* Uncomfortable question */
.uncomfortable-question {
  font-style: italic;
  font-size: 1.15rem;
  color: var(--section-color);
  border-left: 4px solid var(--section-color);
  padding: 1rem 1.5rem;
  margin: 2rem 0;
  background: var(--bg-secondary);
  border-radius: 0 6px 6px 0;
  line-height: 1.7;
}

/* Axiom blocks */
.axioms-block {
  margin: 2.5rem 0;
}

.axioms-block h3 {
  font-family: var(--font-heading);
  font-size: 0.85rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.axiom-list {
  list-style: none;
  counter-reset: axiom;
}

.axiom-list .axiom {
  counter-increment: axiom;
  font-family: var(--font-axiom);
  font-size: 0.9rem;
  line-height: 1.7;
  background: var(--bg-secondary);
  border-left: 3px solid var(--section-color);
  padding: 0.7rem 1rem 0.7rem 2.5rem;
  margin: 0.4rem 0;
  border-radius: 0 4px 4px 0;
  position: relative;
  color: var(--text-primary);
  transition: background var(--transition-speed);
}

.axiom-list .axiom::before {
  content: counter(axiom);
  position: absolute;
  left: 0.7rem;
  font-family: var(--font-heading);
  font-weight: 700;
  font-size: 0.8rem;
  color: var(--section-color);
  opacity: 0.7;
}

.axiom-list .axiom .axiom-name {
  font-weight: 700;
  color: var(--section-color);
}

/* Explanation paragraphs */
.explanation {
  margin: 2.5rem 0;
}

.explanation p {
  margin-bottom: 1.2rem;
  color: var(--text-primary);
}

.explanation p:last-child {
  margin-bottom: 0;
}

/* --- Visualization Containers --- */
.visualization-container {
  margin: 3rem 0;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  background: var(--bg-secondary);
  transition: background var(--transition-speed), border-color var(--transition-speed);
}

.viz-label {
  font-family: var(--font-heading);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  padding: 0.8rem 1rem 0;
}

.viz-canvas-wrap {
  position: relative;
  width: 100%;
  min-height: 320px;
}

.viz-canvas-wrap canvas {
  display: block;
  width: 100%;
  height: 100%;
}

.viz-canvas-wrap svg {
  display: block;
  width: 100%;
  height: 100%;
}

.viz-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  padding: 0.8rem 1rem;
  border-top: 1px solid var(--border);
  background: var(--bg-primary);
}

.viz-controls button {
  font-family: var(--font-heading);
  font-size: 0.8rem;
  font-weight: 500;
  padding: 0.4rem 0.9rem;
  border: 1px solid var(--border);
  border-radius: 5px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  cursor: pointer;
  transition: all 0.15s;
}

.viz-controls button:hover {
  border-color: var(--section-color);
  color: var(--section-color);
}

.viz-controls button.active {
  background: var(--section-color);
  color: #fff;
  border-color: var(--section-color);
}

.viz-controls select {
  font-family: var(--font-heading);
  font-size: 0.8rem;
  padding: 0.4rem 0.6rem;
  border: 1px solid var(--border);
  border-radius: 5px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  cursor: pointer;
}

.viz-controls label {
  font-family: var(--font-heading);
  font-size: 0.8rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.viz-controls input[type="range"] {
  width: 100px;
  accent-color: var(--section-color);
}

.viz-info {
  font-family: var(--font-heading);
  font-size: 0.8rem;
  color: var(--text-muted);
  padding: 0.5rem 1rem;
  border-top: 1px solid var(--border);
  min-height: 1.8rem;
}

/* --- Meta-Axiom Sections --- */
.meta-section {
  background: var(--bg-meta);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  padding: 4rem 0;
  margin: 0 -2rem var(--section-gap);
  padding-left: 2rem;
  padding-right: 2rem;
  position: relative;
}

.meta-section::before {
  content: '\25C6';
  display: block;
  text-align: center;
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-bottom: 2rem;
  opacity: 0.5;
}

.meta-header {
  text-align: center;
  margin-bottom: 2.5rem;
}

.meta-header h2 {
  font-family: var(--font-heading);
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--text-primary);
}

.meta-count {
  font-weight: 400;
  color: var(--text-muted);
  font-size: 0.9rem;
}

.meta-subtitle {
  font-size: 0.95rem;
  color: var(--text-muted);
  font-style: italic;
  margin-top: 0.5rem;
}

.meta-content h3 {
  font-family: var(--font-heading);
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin: 2rem 0 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.meta-content p {
  margin-bottom: 1rem;
  color: var(--text-primary);
}

/* Meta-axiom callout boxes */
.meta-axiom-box {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 1rem 1.2rem;
  margin: 1rem 0;
}

.meta-axiom-box .meta-axiom-label {
  font-family: var(--font-heading);
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--text-muted);
  display: block;
  margin-bottom: 0.3rem;
}

.meta-axiom-box p {
  font-family: var(--font-axiom);
  font-size: 0.88rem;
  line-height: 1.6;
  margin: 0;
  color: var(--text-primary);
}

/* Systems seen scorecard */
.systems-seen {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  margin: 1.5rem 0;
}

.systems-seen .sys-tag {
  font-family: var(--font-heading);
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  padding: 0.2rem 0.6rem;
  border-radius: 3px;
  border: 1px solid var(--border);
  color: var(--text-muted);
}

.systems-seen .sys-tag.seen {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border-color: var(--text-muted);
}

/* --- Finale Section --- */
.finale-section {
  padding: 4rem 0;
  margin-bottom: var(--section-gap);
  border-top: 3px solid var(--color-finale);
}

.finale-section h2 {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-finale);
  margin-bottom: 1.5rem;
}

.finale-section h3 {
  font-family: var(--font-heading);
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin: 2rem 0 0.8rem;
}

.finale-section p {
  margin-bottom: 1rem;
}

.finale-section .axiom-list .axiom {
  border-left-color: var(--color-finale);
}

.finale-section .axiom-list .axiom::before {
  color: var(--color-finale);
}

.finale-section .axiom-list .axiom .axiom-name {
  color: var(--color-finale);
}

/* --- General Typography --- */
strong {
  font-weight: 600;
}

em {
  font-style: italic;
}

a {
  color: var(--section-color, var(--color-sets));
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
}

/* --- Video Embeds --- */
.video-embed {
  margin: 2rem 0 0;
}

.video-embed .video-label {
  font-family: var(--font-heading);
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 0.6rem;
}

.video-embed .video-label a {
  color: var(--text-muted);
  text-decoration: none;
  transition: color var(--transition-speed);
}

.video-embed .video-label a:hover {
  color: var(--text-primary);
}

.video-responsive {
  position: relative;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.video-responsive iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: 0;
}

/* --- Responsive --- */
@media (max-width: 960px) {
  main {
    margin-left: auto;
    padding: 1.5rem 1.5rem 6rem;
  }

  .side-nav {
    transform: translateX(-100%);
    box-shadow: 4px 0 24px var(--shadow);
  }

  .side-nav.open {
    transform: translateX(0);
  }

  .nav-hamburger {
    display: block;
  }

  .hero {
    padding-top: 4rem;
  }

  .hero h1 {
    font-size: 2rem;
  }

  .meta-section {
    margin-left: -1.5rem;
    margin-right: -1.5rem;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }
}

@media (max-width: 600px) {
  :root {
    --font-size-base: 1rem;
  }

  main {
    padding: 1rem 1rem 4rem;
  }

  .hero h1 {
    font-size: 1.7rem;
  }

  .section-number {
    font-size: 2rem;
  }

  .math-section h2 {
    font-size: 1.4rem;
  }

  .uncomfortable-question {
    font-size: 1rem;
    padding: 0.8rem 1rem;
  }

  .axiom-list .axiom {
    font-size: 0.8rem;
    padding: 0.6rem 0.8rem 0.6rem 2rem;
  }

  .meta-section {
    margin-left: -1rem;
    margin-right: -1rem;
    padding-left: 1rem;
    padding-right: 1rem;
  }

  .viz-canvas-wrap {
    min-height: 250px;
  }
}

/* --- Utility --- */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
